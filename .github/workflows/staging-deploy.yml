name: Secret-Diagnose
on: { workflow_dispatch: {} }

jobs:
  diag:
    runs-on: ubuntu-latest
    # falls du Environment-Secrets nutzt, setze das Environment:
    # environment: staging
    steps:
      - name: Check secret presence and fingerprint
        shell: bash
        run: |
          if [ -z "${{ secrets.SSH_PRIVATE_KEY }}" ]; then
            echo "❌ SSH_PRIVATE_KEY is EMPTY"
            exit 1
          fi
          echo "✅ SSH_PRIVATE_KEY exists (not printing it)."
          printf '%s\n' "${{ secrets.SSH_PRIVATE_KEY }}" > key.tmp
          chmod 600 key.tmp
          ssh-keygen -y -f key.tmp > key.pub
          ssh-keygen -lf key.pub